# Attack Graph Generation
The class ```CTIgraph.AttackGraphGenerator``` is responsible for the generation of Attack Graphs by using MulVAL and the inputs extracted by MulValInputExtractor.  
AttackGraphGenerator is initialized by passing it the paths to the input facts and rules and the directory in which to save the outputs of the generation (*working directory* by default).  

## Graph Generation
The method ```gen_graph()``` generates the Attack Graphs by calling MulVAL.  
By default the outputted Attack Graph will be pruned in order to leave only the nodes related to:

- *Attacker's Starting Location*
- *Exploited Vulnerabilities*
- *Technique Preconditions*
- *Technique Derivation Rules*
- *Attack Step*
- *Technique Consequences*

```no_prune = True``` can be specified to output the full, unpruned, attack graph.  
By default most of the outputs generated by MulVAL will be removed leaving only:

- *AttackGraph.dot*, the .dot representation of the attack graph.
- *AttackGraph.pdf*, visual representation fo the attack graph generated by GraphViz.

```cleanup = False``` can be specified to keep the full outputs of MulVAL.  
Other than the GraphViz visualization of the graph (default of MulVAL), the generated graph can be exported to AttackFlow-compliant JSON (```to_flow = True```) or to .mmd (```to_mermaid = True```).
## Graph Formatting
```AGFormatter``` is the class responsible for formatting an AttackGraph (described in a .dot file or as a NetworkX DiGraph) to a different format (currently AttackFlow or Mermaid).  
### AttackFlow
The ```to_flow()``` method traverses the Attack Graph recursively starting from its root (*attackerLocated* node) looking for Technique attack_step nodes. When one is found an AttackAction SDO is generated for that technique. The pod targeted by the Technique execution is represented as an AttackAsset SDO. Any vulnerability exploited by the Technique is represented as a Vulnerability SDO and associated to the AttackAction with an SRO. Any consequences caused by the Technique execution on the pod is included in the AttackAsset description. The SDO ID of any downstream Technique is appended to the *effects_refs* of the AttackAsset.
### Mermaid
The ```to_mermaid()``` method traverses the Attack Graph recursively ooking for Technique attack_step nodes. When one is found a node is created indicating the Technique and the targeted pod. A node is created for any vulnerability exploited by the technique. The consequences of the Technique execution are represented by downstream nodes.